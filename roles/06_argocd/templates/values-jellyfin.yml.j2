# default values https://github.com/jellyfin/jellyfin-helm/blob/master/charts/jellyfin/values.yaml
jellyfin:
  ingress:
    enabled: true
    className: traefik
    annotations:
      traefik.ingress.kubernetes.io/router.entrypoints: websecure
    hosts:
      - host: jellyfin.{{ domain }}
        paths:
          - path: /
            pathType: Prefix
    tls:
      - hosts:
          - jellyfin.{{ domain }}

  podSecurityContext:
{% if jellyfin_hw.enabled %}
    fsGroup: 104  # Changed from 0 to 104 for video group access
{% else %}
    fsGroup: 0
{% endif %}
  
  securityContext:
{% if jellyfin_hw.enabled %}
    privileged: true  # Required for hardware acceleration
    runAsUser: 0
    runAsGroup: 0
{% else %}
    runAsUser: 0
    runAsGroup: 0
{% endif %}

{% if jellyfin_hw.enabled %}
# Hardware acceleration volumes and mounts
  volumes:
    - name: jellyfin-hardware
      hostPath:
        path: {{ jellyfin_hw.path }}

  volumeMounts:
    - name: jellyfin-hardware
      mountPath: {{ jellyfin_hw.path }}
{% endif %}

  persistence:
    config:
      enabled: true
      mountPath: /config
      storageClass: longhorn
      accessMode: ReadWriteOnce
      size: 1Gi
{% if external_storage.enabled and external_storage.applications.qbittorrent.enabled %} 
    media:
      enabled: true
      type: pvc
      existingClaim: "{{ external_storage.applications.qbittorrent.pvc_name }}"
{% endif %}