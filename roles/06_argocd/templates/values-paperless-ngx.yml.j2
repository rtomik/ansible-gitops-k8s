paperless-ngx:
  ## Image settings
  image:
    repository: ghcr.io/paperless-ngx/paperless-ngx
    tag: "2.18.4"
    pullPolicy: IfNotPresent
    
  ingress:
    enabled: true
    className: "traefik"
    annotations:
      traefik.ingress.kubernetes.io/router.entrypoints: websecure
    hosts:
      - host: paperless.{{domain}}
        paths:
          - path: /
            pathType: Prefix
    tls:
      - hosts:
          - paperless.{{domain}}

  persistence:
    # Paperless data directory (search index, classification model, etc.)
    data:
      enabled: true
      storageClass: "longhorn"
      accessMode: ReadWriteOnce
      size: 1Gi
    # Paperless media directory (documents and thumbnails)
    media:
      enabled: true
      storageClass: "longhorn"
      accessMode: ReadWriteOnce
      size: 10Gi
    # Export directory (for exporting documents)
    export:
      enabled: true
      storageClass: "longhorn"
      accessMode: ReadWriteOnce
      size: 1Gi
    # Consume directory (for importing documents)
    consume:
      enabled: true
      storageClass: "longhorn"
      accessMode: ReadWriteOnce
      size: 5Gi

  postgresql:
    # External PostgreSQL connection details
    external:
      enabled: true
      host: "postgres-cluster-pooler.dbs.svc.cluster.local"
      port: 5432
      database: "paperless"
      username: "paperless"
      # Use existingSecret for credentials
      existingSecret: "paperless-db-credentials"
      passwordKey: "password"

  redis:
    external:
      enabled: true
      host: "dragonfly-sample.default.svc.cluster.local"
      port: 6379
      database: 0
      # Use existingSecret for credentials if Redis has auth
      existingSecret: ""
      passwordKey: "redis-password"
      # Or set password directly (leave empty if no auth)
      password: ""

  config:
    url: https://paperless.tomik.lat
    allowedHosts: "*"

{% if deploy_authentik %}
  env: 
    - name: PAPERLESS_APPS
      value: "allauth.socialaccount.providers.openid_connect"
    - name: PAPERLESS_SOCIALACCOUNT_PROVIDERS
      value: |
            {
              "openid_connect": {
                "APPS": [
                  {
                    "provider_id": "authentik",
                    "name": "Authentik",
                    "client_id": "$authentik_client_id",
                    "secret": "$authentik_client_secret",
                    "settings": {
                      "server_url": "https://authentik.tomik.lat/application/o/paperless-ngx/.well-known/openid-configuration"
                    }
                  }
                ],
                "OAUTH_PKCE_ENABLED": "True"
              }
            }    
  extraEnvFrom: 
    - secretRef:
        name: paperless-authentik-credentials
{% endif %}        
